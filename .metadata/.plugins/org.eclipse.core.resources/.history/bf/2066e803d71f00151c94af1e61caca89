/*
 * main.c
 *
 *  Created on: Jun 20, 2015
 *      Author: abubakr
 */


#include "main.h"
#include "app.h"


uint8 * passwd;

int main (void){

	uint8 a=0xbb, * returnPasswd;
	passwd=(uint8 *) malloc(15);

	// APP_Init() intialize LCD and UART

	APP_Init();

	// Ask MC2 for a value which is saved in eeprom, if it return 0xbb it means that the user password
    //	is already entered and saved in eeprom and will take the user to the default screen directly.

	UART_SendByte(M2_READY); // MC2 is ready
	a=UART_RecieveByte();

	// Set User Password for the first time.

	if (a != FIRST_CHECK){
		while (set_Passwd()){
			set_Passwd();
		}

		// Send password to MC2 to save to eeprom.

		while(UART_RecieveByte() != M2_READY){} // wait until MC2 is ready
		UART_SendString(passwd);

	while(UART_RecieveByte() != M2_READY){} // wait until MC2 is ready
	UART_SendByte(FIRST_CHECK);
	}

	defaultScreen();

	while(1){

		if(KeyPad_GetPressedKey()== '+'){
			changePassword();
		}

		if(KeyPad_GetPressedKey()== '-'){

			openDoor();
		}
	}
	return (0);

}
